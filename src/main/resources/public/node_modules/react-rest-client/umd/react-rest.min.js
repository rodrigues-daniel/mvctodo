!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e.ReactREST={},e.React)}(this,function(e,t){"use strict";function n(e){return function(){return e}}function r(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var o="default"in t?t.default:t,i=function(){};i.thatReturns=n,i.thatReturnsFalse=n(!1),i.thatReturnsTrue=n(!0),i.thatReturnsNull=n(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e};var s=i,a=function(e,t,n,r,o,i,s,a){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,o,i,s,a],l=0;(u=new Error(t.replace(/%s/g,function(){return c[l++]}))).name="Invariant Violation"}throw u.framesToPop=1,u}},u=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,p=(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()&&Object.assign,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"),f=function(){function e(e,t,n,r,o,i){i!==p&&a(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=s,n.PropTypes=n,n},h=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){e.exports=f()}),d=(function(){function e(e){this.value=e}function t(t){function n(o,i){try{var s=t[o](i),a=s.value;a instanceof e?Promise.resolve(a.value).then(function(e){n("next",e)},function(e){n("throw",e)}):r(s.done?"return":"normal",s.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?n(o.key,o.arg):i=null}var o,i;this._invoke=function(e,t){return new Promise(function(r,s){var a={key:e,arg:t,resolve:r,reject:s,next:null};i?i=i.next=a:(o=i=a,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},E=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(e){function t(){var n,r,i;d(this,t);for(var s=arguments.length,a=Array(s),u=0;u<s;u++)a[u]=arguments[u];return n=r=E(this,e.call.apply(e,[this].concat(a))),r.getChildContext=function(){var e=r.props,t=e.base,n=e.middleware;return{rest:y({},r.context.rest,{base:t,path:[],middleware:n})}},r.render=function(){return o.Children.only(r.props.children)},i=n,E(r,i)}return b(t,e),t}(t.Component);v.defaultProps={middleware:[]},v.contextTypes={rest:h.object},v.childContextTypes={rest:h.object.isRequired};var m={BROWSE:"@@REACT_REST_METHOD/BROWSE",READ:"@@REACT_REST_METHOD/READ",EDIT:"@@REACT_REST_METHOD/EDIT",ADD:"@@REACT_REST_METHOD/ADD",DESTROY:"@@REACT_REST_METHOD/DESTROY",REPLACE:"@@REACT_REST_METHOD/REPLACE",WIPE:"@@REACT_REST_METHOD/WIPE"},O=function e(t,n,r){var o=this;d(this,e),this.call=function(e,t){return o.fetch(o.url+"/"+o.pk,y({},e,{type:t}))},this.read=function(){return o.call(m.READ)},this.edit=function(e){return o.call({method:"PATCH",body:e},m.EDIT)},this.destroy=function(){return o.call({method:"DELETE"},m.DESTROY)},this.replace=function(e){return o.call({method:"PUT",body:e},m.REPLACE)},this.url=t,this.pk=n,this.fetch=r},T=function(e){return e.keys().map(function(t){return{key:t,value:e[t]}})},R=function e(t,n){d(this,e),w.call(this),this.url=t,this.fetch=n},w=function(){var e=this;this.params={},this.buildParams=function(t){var n=y({},e.params,t);return n&&0!==Object.keys(n).length?"?"+T(n).map(function(e){return e.key+"="+e.value}).join("&"):""},this.call=function(t,n,r){return e.fetch(t,y({},n,{type:r}))},this.browse=function(t){return e.call(""+e.url+e.buildParams(t),{},m.BROWSE)},this.read=function(t){return e.call(e.url+"/"+t,{},m.READ)},this.edit=function(t,n){return e.call(e.url+"/"+t,{method:"PATCH",body:n},m.EDIT)},this.add=function(t){return e.call(""+e.url,{method:"POST",body:t},m.ADD)},this.destroy=function(t){return e.call(e.url+"/"+t,{method:"DELETE"},m.DESTROY)},this.replace=function(t,n){return e.call(e.url+"/"+t,{method:"PUT",body:n},m.REPLACE)},this.wipe=function(t){return e.call(""+e.url+e.buildParams(t),{method:"DELETE"},m.WIPE)},this.bind=function(t){return new O(e.url,t,e.fetch)}},g=function(e,t){return{before:e,after:t}},j=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(n){return n||(n={}),n.hasOwnProperty("headers")||(n.headers={}),e&&(n.headers.Accept="application/json",n.body&&(n.body=JSON.stringify(n.body))),t&&(n.headers["Content-Type"]="application/json; charset=utf-8"),n}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(t){return e?t.json():t.clone().json().then(function(e){return t.data=e,t})}},S=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.map(function(e){return e.before}),o=e.map(function(e){return e.after}),i=r.reduce(function(e,t){return t(e)},n);return fetch(t,i).then(function(e){return e.request=i,o.reduce(function(e,t){return t(e)},e)})}},C={injectHeaders:function(e){return g(function(t){return t?t.hasOwnProperty("headers")?y({},t,{headers:y({},t.headers,e)}):y({},t,{headers:e}):{headers:e}},function(e){return e})},injectJsonHeaders:j,parseJsonResponse:P,handleJson:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return g(j(),P(e))},fetchWithMiddleware:S},_=function(e){function t(){var n,r,i;d(this,t);for(var s=arguments.length,a=Array(s),u=0;u<s;u++)a[u]=arguments[u];return n=r=E(this,e.call.apply(e,[this].concat(a))),r.state={response:!1},r.handlers=!1,r.getChildContext=function(){var e=r.props,t=e.path,n=e.persist,o=r.context.rest,i=o.base,s=o.path,a=o.middleware,u=n?"/"===t[0]?[t]:[].concat(s,[t]):s;return{rest:y({},r.context.rest,{base:i,path:u,middleware:a})}},r.componentWillMount=function(){r.createHandlers(r.props,r.context),r.props.noFetchOnMount||r.handlers.browse(r.props.options)},r.componentWillReceiveProps=function(e,t){r.createHandlers(e,t),e.noFetchOnMount||r.handlers.browse(e.options)},r.createHandlers=function(e,t){var n=e.pk,o=e.path,i=e.options,s=e.middleware,a=e.suppressUpdate,u=t.rest,c=u.base,l=u.path,p=u.middleware,f=c+"/"+("/"===o[0]?o.slice(1):[].concat(l,[o]).join("/"));if(n){var h=g(function(e){return e},function(e){return e.then(function(e){return e.request.type===m.DESTROY?r.handlers.read():a||r.setState({response:e}),e})}),d=[].concat(p,s,[h]),y=S(d);r.handlers=new O(f,n,y)}else{var b=g(function(e){return e},function(e){return e.then(function(e){return e.request.type!==m.BROWSE?r.handlers.browse(i):a||r.setState({response:e}),e})}),E=[].concat(p,s,[b]),v=S(E);r.handlers=new R(f,v)}},r.render=function(){var e=r.props,t=e.component,n=e.render,i=e.children,s={response:r.state.response,handlers:r.handlers};return t?o.createElement(t,s):n?n(s):i?"function"==typeof i?i(s):!Array.isArray(i)||i.length?o.cloneElement(o.Children.only(i),s):null:null},i=n,E(r,i)}return b(t,e),t}(t.Component);_.defaultProps={options:{},noFetchOnMount:!1,suppressUpdate:!1,persist:!0},_.contextTypes={rest:h.shape({base:h.string.isRequired,path:h.array.isRequired,middleware:h.array.isRequired})},_.childContextTypes={rest:h.object.isRequired};var x=function(e){return y({options:{},noFetchOnMount:!1,suppressUpdate:!1},e)},D=function(e){function t(n,r){d(this,t);var o=E(this,e.call(this,n,r));return A.call(o),o.state=Object.keys(n.configs).map(function(e){var t;return t={},t[e]=!1,t}).reduce(function(e,t){return y({},e,t)}),o}return b(t,e),t}(t.Component);D.contextTypes={rest:h.shape({base:h.string.isRequired,path:h.array.isRequired,middleware:h.array.isRequired})},D.childContextTypes={rest:h.object.isRequired};var A=function(){var e=this;this.handlers={},this.getChildContext=function(){var t=e.props,n=t.configs,r=t.persist,o=e.context.rest,i=o.base,s=o.path,a=o.middleware,u=r?"/"===n[r].path[0]?[n[r].path]:[].concat(s,[n[r].path]):s;return{rest:y({},e.context.rest,{base:i,path:u,middleware:a})}},this.componentWillMount=function(){e.createHandlers(e.props,e.context),Object.keys(e.props.configs).forEach(function(t){e.props.configs[t].noFetchOnMount||e.handlers[t].browse(e.props.options)})},this.componentWillReceiveProps=function(t,n){e.createHandlers(t,n),Object.keys(t.configs).forEach(function(n){t.configs[n].noFetchOnMount||e.handlers[n].browse(t.options)})},this.createHandlers=function(t,n){var r=e.props.configs;Object.keys(r).forEach(function(t){var o=x(r[t]),i=o.pk,s=o.path,a=o.options,u=o.middleware,c=o.suppressUpdate,l=n.rest,p=l.base,f=l.path,h=l.middleware,d=p+"/"+("/"===s[0]?s.slice(1):[].concat(f,[s]).join("/"));if(i){var y=g(function(e){return e},function(n){return n.then(function(n){if(n.request.type===m.DESTROY)e.handlers[t].read();else if(!c){var r;e.setState((r={},r[t]=n,r))}return n})}),b=[].concat(h,u,[y]),E=S(b);e.handlers[t]=new O(d,i,E)}else{var v=g(function(e){return e},function(n){return n.then(function(n){if(n.request.type!==m.BROWSE)e.handlers[t].browse(a);else if(!c){var r;e.setState((r={},r[t]=n,r))}return n})}),T=[].concat(h,u,[v]),w=S(T);e.handlers[t]=new R(d,w)}})},this.render=function(){var t=e.props,n=t.component,r=t.render,i=t.children,s=t.configs,a=Object.keys(s).map(function(t){var n;return n={},n[t]={response:e.state[t],handlers:e.handlers[t]},n}).reduce(function(e,t){return y({},e,t)});return n?o.createElement(n,a):r?r(a):i?"function"==typeof i?i(a):!Array.isArray(i)||i.length?o.cloneElement(o.Children.only(i),a):null:null}};e.Client=v,e.Endpoint=_,e.Endpoints=D,e.middleware=C,Object.defineProperty(e,"__esModule",{value:!0})});
