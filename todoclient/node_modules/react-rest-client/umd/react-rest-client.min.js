!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e.ReactREST={},e.React)}(this,function(e,t){"use strict";function n(e){return function(){return e}}function r(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var o="default"in t?t.default:t,i=function(){};i.thatReturns=n,i.thatReturnsFalse=n(!1),i.thatReturnsTrue=n(!0),i.thatReturnsNull=n(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e};var c=i,u=function(e,t,n,r,o,i,c,u){if(!e){var a;if(void 0===t)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,o,i,c,u],f=0;(a=new Error(t.replace(/%s/g,function(){return s[f++]}))).name="Invariant Violation"}throw a.framesToPop=1,a}},a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,l=(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()&&Object.assign,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"),p=function(){function e(e,t,n,r,o,i){i!==l&&u(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=c,n.PropTypes=n,n},h=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){e.exports=p()}),d=(function(){function e(e){this.value=e}function t(t){function n(o,i){try{var c=t[o](i),u=c.value;u instanceof e?Promise.resolve(u.value).then(function(e){n("next",e)},function(e){n("throw",e)}):r(c.done?"return":"normal",c.value)}catch(e){r("throw",e)}}function r(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}(o=o.next)?n(o.key,o.arg):i=null}var o,i;this._invoke=function(e,t){return new Promise(function(r,c){var u={key:e,arg:t,resolve:r,reject:c,next:null};i?i=i.next=u:(o=i=u,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(e){function t(){var n,r,i;d(this,t);for(var c=arguments.length,u=Array(c),a=0;a<c;a++)u[a]=arguments[a];return n=r=b(this,e.call.apply(e,[this].concat(u))),r.getChildContext=function(){var e=r.props,t=e.base,n=e.middleware;return{rest:y({},r.context.rest,{base:t,path:[],middleware:n})}},r.render=function(){return o.Children.only(r.props.children)},i=n,b(r,i)}return E(t,e),t}(t.Component);v.defaultProps={middleware:[]},v.contextTypes={rest:h.object},v.childContextTypes={rest:h.object.isRequired};var O={BROWSE:"@@REACT_REST_METHOD/BROWSE",READ:"@@REACT_REST_METHOD/READ",EDIT:"@@REACT_REST_METHOD/EDIT",ADD:"@@REACT_REST_METHOD/ADD",DESTROY:"@@REACT_REST_METHOD/DESTROY",REPLACE:"@@REACT_REST_METHOD/REPLACE",WIPE:"@@REACT_REST_METHOD/WIPE"},T=function e(t,n,r){var o=this;d(this,e),this.call=function(e,t){return o._fetch(o.url+"/"+o.pk,y({},e,{type:t}))},this.read=function(){return o.call(O.READ)},this.edit=function(e){return o.call({method:"PATCH",body:e},O.EDIT)},this.destroy=function(){return o.call({method:"DELETE"},O.DESTROY)},this.replace=function(e){return o.call({method:"PUT",body:e},O.REPLACE)},this.fetch=function(){return o.read()},this.url=t,this.pk=n,this._fetch=r},g=function e(t,n,r){d(this,e),R.call(this),this.url=t,this._fetch=n,this.params=r},R=function(){var e=this;this.params={},this.buildParams=function(t){var n=y({},e.params,t);return n&&0!==Object.keys(n).length?"?"+new URLSearchParams(n).toString():""},this.call=function(t,n,r){return e._fetch(t,y({},n,{type:r}))},this.browse=function(t){return e.call(""+e.url+e.buildParams(t),{},O.BROWSE)},this.read=function(t){return e.call(e.url+"/"+t,{},O.READ)},this.edit=function(t,n){return e.call(e.url+"/"+t,{method:"PATCH",body:n},O.EDIT)},this.add=function(t){return e.call(""+e.url,{method:"POST",body:t},O.ADD)},this.destroy=function(t){return e.call(e.url+"/"+t,{method:"DELETE"},O.DESTROY)},this.replace=function(t,n){return e.call(e.url+"/"+t,{method:"PUT",body:n},O.REPLACE)},this.wipe=function(t){return e.call(""+e.url+e.buildParams(t),{method:"DELETE"},O.WIPE)},this.fetch=function(t){return e.browse()},this.bind=function(t){return new T(e.url,t,e._fetch)}},w=function(e,t){return{before:e,after:t}},j=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(n){return n||(n={}),n.hasOwnProperty("headers")||(n.headers={}),e&&(n.headers.Accept="application/json",n.body&&(n.body=JSON.stringify(n.body))),t&&(n.headers["Content-Type"]="application/json; charset=utf-8"),n}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(t){return e?t.json():t.clone().json().then(function(e){return t.data=e,t})}},_=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.map(function(e){return e.before}),o=e.map(function(e){return e.after}),i=r.reduce(function(e,t){return t(e)},n),c=fetch(t,i).then(function(e){return e.request=i,e});return o.reduce(function(e,t){return e.then(t)},c)}},S={injectHeaders:function(e){return w(function(t){return t?t.hasOwnProperty("headers")?y({},t,{headers:y({},t.headers,e)}):y({},t,{headers:e}):{headers:e}},function(e){return e})},injectJsonHeaders:j,parseJsonResponse:P,handleJson:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return w(j(),P(e))},fetchWithMiddleware:_},C=function(e){return y({middleware:[],options:{},noFetchOnMount:!1,suppressUpdate:!1,onChange:function(){}},e)},D=function(e){function t(n,r){d(this,t);var o=b(this,e.call(this,n,r));return A.call(o),o.state=Object.keys(n.configs).map(function(e){var t;return t={},t[e]=!1,t}).reduce(function(e,t){return y({},e,t)}),o}return E(t,e),t}(t.Component);D.defaultProps={middleware:[],onChange:function(){}},D.contextTypes={rest:h.shape({base:h.string.isRequired,path:h.array.isRequired,middleware:h.array.isRequired})},D.childContextTypes={rest:h.object.isRequired};var A=function(){var e=this;this.handlers={},this.getChildContext=function(){var t=e.props,n=t.configs,r=t.persist,o=e.context.rest,i=o.base,c=o.path,u=r?function(e,t){return t?[].concat(e,[t]):e}(function(e,t){return"/"===t[0]?[t.slice(1)]:[].concat(e,[t])}(c,n[r].path),n[r].pk):c;return{rest:y({},e.context.rest,{base:i,path:u})}},this.componentWillMount=function(){e.createHandlers(e.props,e.context),Object.keys(e.props.configs).forEach(function(t){e.props.configs[t].noFetchOnMount||e.handlers[t].fetch(e.props.options)})},this.componentWillReceiveProps=function(t,n){e.createHandlers(t,n),Object.keys(t.configs).forEach(function(n){t.configs[n].noFetchOnMount||e.handlers[n].fetch(t.options)})},this.componentDidUpdate=function(t,n){var r=e.props,o=r.configs,i=r.onChange,c=Object.keys(o).map(function(t){var n;return n={},n[t]={response:e.state[t],handlers:e.handlers[t]},n}).reduce(function(e,t){return y({},e,t)});Object.keys(c).forEach(function(t){JSON.stringify(e.state[t])!==JSON.stringify(n[t])&&C(o[t]).onChange(c[t])}),JSON.stringify(e.state)!==JSON.stringify(n)&&i(c)},this.createHandlers=function(t,n){var r=e.props,o=r.configs,i=r.middleware;Object.keys(o).forEach(function(t){var r=C(o[t]),c=r.pk,u=r.path,a=r.options,s=r.middleware,f=r.suppressUpdate,l=n.rest,p=l.base,h=l.path,d=l.middleware,y=p+"/"+("/"===u[0]?u.slice(1):[].concat(h,[u]).join("/"));if(c){var E=w(function(e){return e},function(n){if(n.request.type===O.DESTROY)e.handlers[t].read();else if(!f){var r;e.setState((r={},r[t]=n,r))}return n}),m=[].concat(d,i,s,[E]),b=_(m);e.handlers[t]=new T(y,c,b)}else{var v=w(function(e){return e},function(n){if(n.request.type!==O.BROWSE)e.handlers[t].browse();else if(!f){var r;e.setState((r={},r[t]=n,r))}return n}),R=[].concat(d,i,s,[v]),j=_(R);e.handlers[t]=new g(y,j,a)}})},this.render=function(){var t=e.props,n=t.component,r=t.render,i=t.children,c=t.configs,u=Object.keys(c).map(function(t){var n;return n={},n[t]={response:e.state[t],handlers:e.handlers[t]},n}).reduce(function(e,t){return y({},e,t)});return n?o.createElement(n,u):r?r(u):i?"function"==typeof i?i(u):!Array.isArray(i)||i.length?o.cloneElement(o.Children.only(i),u):null:null}},k=function(e){function t(){var n,r,i;d(this,t);for(var c=arguments.length,u=Array(c),a=0;a<c;a++)u[a]=arguments[a];return n=r=b(this,e.call.apply(e,[this].concat(u))),r.render=function(){var e=r.props,t=e.component,n=e.render,i=e.children,c=m(e,["component","render","children"]);return o.createElement(D,{configs:{props:c},render:function(e){var r=e.props;return t?o.createElement(t,r):n?n(r):i?"function"==typeof i?i(r):!Array.isArray(i)||i.length?o.cloneElement(o.Children.only(i),r):null:null}})},i=n,b(r,i)}return E(t,e),t}(t.Component);k.defaultProps={middleware:[],options:{},noFetchOnMount:!1,suppressUpdate:!1,persist:!0,onChange:function(){}};e.Client=v,e.Endpoint=k,e.Endpoints=D,e.withEndpoint=function(e){return function(t){return o.createElement(k,y({},e,{component:t}))}},e.withEndpoints=function(e){return function(t){return o.createElement(D,y({},e,{component:t}))}},e.middleware=S,Object.defineProperty(e,"__esModule",{value:!0})});
